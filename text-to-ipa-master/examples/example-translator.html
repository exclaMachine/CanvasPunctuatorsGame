<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Text to IPA Converter</title>
    <link rel="stylesheet" href="styles.css"> <!-- If you have a CSS file -->
</head>
<body>
    <h1>Text to IPA Conversion Tool</h1>
    <div id="js-text-to-ipa-form">
        <ul style="list-style-type: none;">
            <li>
                <textarea id="ipa-in" placeholder="Write text here!" rows="4" cols="50"></textarea>
            </li>
            <li>
                <select id="conversionType">
                    <option value="ipa">IPA</option>
                    <option value="shatner">Shatner</option>
                    <option value="english">English</option>
                </select>
            </li>
            <li class="button">
                <button type="button" id="js-ipa-submit" onClick="convertText()">Convert!</button>
            </li>
            <li>
                <textarea readonly id="ipa-out" placeholder="Output goes here!" rows="4" cols="50"></textarea>
            </li>
        </ul>
        <ul style="list-style-type: none;">
            <li>
                <div id="ipa-err">
                    <p>Errors will be displayed here.</p>
                </div>
            </li>
        </ul>
    </div>
    <script src="../lib/text-to-ipa.js"></script>
    <script src="../lib/converter-form.js"></script>
    <script>
        window.onload = function() {
            TextToIPA.loadDict('../lib/ipadict.txt');
        };

        const phoneticAlphToEnglishConversions = {
            "eɪ": "ay",
            "aɪ": "I",
            "Aɪ": "I",
            "oʊ": "O",
            "aʊ": "ow",
            "ɔɪ": "oy",
            "ʧ": "ch",
            "ʤ": "dg",
            "ŋ": "ng",
            "ʃ": "sh",
            "ð": "TH",
            "θ": "th",
            "ɛ": "e",
            "ʒ": "zh",
            "æ": "a",
            "ɪ": "i",
            "u": "oo",
            "o": "O",
            "a": "A",
            "ɔ": "aw",
            "i": "ee",
            "ə": "ə",
            "ʊ": "oo",
            "j": "y"
        };

        function convertText() {
            var inputText = document.getElementById('ipa-in').value;
            var conversionType = document.getElementById('conversionType').value;

            if (conversionType === 'shatner') {
                var outputText = inputText.split(' ').join(', ');
                document.getElementById('ipa-out').value = outputText;
            } else if (conversionType === 'ipa') {
                ConverterForm.convert('ipa-in', 'ipa-out', 'ipa-err');
            } else if (conversionType === 'english') {
                // Perform IPA conversion first
                ConverterForm.convert('ipa-in', 'ipa-out', 'ipa-err');

                // Add a small delay to ensure IPA conversion is complete
                setTimeout(function() {
                    var ipaOutput = document.getElementById('ipa-out').value;
                    var outputText = ipaOutput;
                    for (let [ipa, eng] of Object.entries(phoneticAlphToEnglishConversions)) {
                        outputText = outputText.split(ipa).join(eng);
                    }
                    document.getElementById('ipa-out').value = outputText;
                }, 100);
            }
        }
    </script>
</body>
</html>
